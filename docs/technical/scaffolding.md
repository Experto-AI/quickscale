# SCAFFOLDING: Repository, Packages, and Generated Project Structures

> Authoritative guide to the directory/file scaffolding for QuickScale across MVP and post-MVP phases. Complements: `decisions.md` (technical rules), `roadmap.md` (timeline/tasks), `README.md` (user intro), `quickscale.md` (strategy).

## Table of Contents
1. Scope & Principles
2. Monorepo Target Layout (Ultimate End-State)
3. Phase 1 (MVP) Required Structure
4. Post-MVP Expansion (Modules & Themes)
5. Generated Project Output (MVP & Post-MVP)
6. Naming & Packaging Matrix (Summary)
7. Rationale Mapping to Decisions
8. Evolution Phases & Incremental Adoption
9. Crosswalk: Requirement → Artifact
10. Future Optional Enhancements
11. Authoring & Maintenance Notes

---
## 1. Scope & Principles
The scaffolding defined here covers:
- Repository-level directory layout (monorepo approach)
- Individual package internal `src/` layouts
- Generated end-user Django project structure (what `quickscale init` produces)
- Progressive evolution from MVP (minimal core) to full ecosystem (modules + themes)

📘 **Evolution Context**: For the strategic rationale behind QuickScale's "personal toolkit first, community platform later" evolution, see [quickscale.md §Evolution Strategy](../overview/quickscale.md#evolution-strategy-personal-toolkit-first).

Guiding principles:
- Explicit > implicit (Django-aligned)
- Isolated packages with clear responsibilities
- Inheritance-friendly theme base classes; additive customization
- Configuration-driven assembly (creation-time, not runtime dynamic loading)
- Tests *outside* `src/` for clean distributions

---
## 1.1. For AI Assistants: How to Use This Document

**Purpose:** This document DESCRIBES directory structures and file layouts. For DECISIONS and RULES, `decisions.md` is authoritative and wins all conflicts.

**When to consult scaffolding.md:**
- ✅ Generating directory structures or file layouts
- ✅ Understanding package organization patterns
- ✅ Creating new modules/themes (Post-MVP)
- ✅ Checking naming conventions (§6)
- ✅ Understanding evolution from MVP to Post-MVP

**When to consult decisions.md instead:**
- ✅ Resolving conflicts or ambiguities (decisions.md wins)
- ✅ Understanding technical prohibitions
- ✅ MVP feature scope questions (MVP Feature Matrix)
- ✅ Package manager/tooling choices
- ✅ Testing requirements and coverage targets
- ✅ Settings inheritance policies

**Tie-breaker Rule:** `decisions.md` is authoritative for ALL technical decisions. This document provides examples and structure; `decisions.md` makes rulings.

### 1.2. Critical Warnings for AI Assistants

> 🚨 **`quickscale_modules/` is NOT generated by default:**
> - ❌ NOT created by `quickscale init`
> - ❌ NOT part of generated user projects
> - ✅ OPTIONAL personal monorepo convention only
> - ✅ Used by maintainers for code organization
> 
> **When generating code:** DO NOT create `quickscale_modules/` directory unless:
> 1. User explicitly maintains a personal monorepo, AND
> 2. User explicitly requests module extraction, AND
> 3. You're working in the QuickScale maintainer repository
>
> **Default behavior:** `quickscale init myapp` generates ONLY standard Django structure (manage.py, settings.py, urls.py, templates/, static/, pyproject.toml).

> 🚨 **MVP vs Post-MVP Scope:**
> - Defer to [MVP Feature Matrix in decisions.md](./decisions.md#mvp-feature-matrix-authoritative) for authoritative IN/OUT/PLANNED status
> - This document shows both MVP and Post-MVP structures for evolution planning
> - Look for 🔎 **Post-MVP reference** markers to identify future-state examples
> - When implementing: ONLY generate MVP-scoped features unless explicitly requested otherwise

### 1.3. Quick Decision Trees for AI Assistants

**Should I generate `quickscale_modules/`?**
```
User runs `quickscale init myapp`? → ❌ NO (never generated)
User explicitly working on quickscale maintainer monorepo? → ✅ YES (maintainer context)
User asks to "extract a module"? → ✅ YES (refer to extraction workflow §5.1)
Default/unclear context? → ❌ NO (standalone Django project only)
```

**Which settings pattern should I use?**
```
MVP project (v0.56-v1.0)? → Standalone settings.py (NO inheritance)
User embedded quickscale_core via git subtree? → Optional inheritance (document both options)
Post-MVP project? → Consult decisions.md settings policy
Default/unclear context? → Standalone settings.py
```

**Should I generate YAML config files?**
```
MVP project? → ❌ NO (quickscale.yml is Post-MVP only)
User explicitly requests YAML config? → Explain it's Post-MVP, offer alternatives
Post-MVP context? → ✅ YES (but confirm scope with decisions.md)
```

---
## 2. Monorepo Target Layout (Post-MVP End-State)

🔎 **Post-MVP reference**: This structure represents the target end-state after Phase 2+. For MVP structure, see Section 3 below.

> NOTE: The `quickscale_modules/` directory shown in the Post‑MVP / monorepo examples is a workspace convention for maintainers and for users who maintain a personal monorepo. It is NOT part of the project generated by `quickscale init`. Generated user projects do NOT include `quickscale_modules/` by default. See `decisions.md#module-extraction-workflow` for authoritative guidance.

### Extraction workflow (example)

The diagram below shows the typical relationship between the QuickScale maintainer monorepo, a user's personal fork/monorepo for extracted modules, and individual generated client projects. This is an illustrative example for advanced users — generated projects do NOT include `quickscale_modules/` by default.

```
QuickScale Maintainer Repo        User's Personal Fork         Generated Client Projects
quickscale/                       my-quickscale/               client-a/
├── quickscale_core/             ├── quickscale_core/         ├── myapp/
├── quickscale_modules/          ├── quickscale_modules/      │   ├── settings.py
│   ├── auth/                    │   ├── my_feature/          │   └── urls.py
│   └── billing/                 │   └── custom_reports/      └── pyproject.toml
└── quickscale_cli/              └── quickscale_cli/
                                 (User extracts features     (No quickscale_modules/
                                  from client projects)        in generated output)
```


```
quickscale/
├── README.md
├── LICENSE
├── CHANGELOG.md
├── pyproject.toml                  # (Optional aggregate tooling meta)
├── docs/
│   ├── index.md
│   ├── overview/
│   ├── technical/
│   └── legacy/
├── scripts/
│   ├── bootstrap.sh
│   ├── lint.sh
│   ├── test_all.sh
│   └── release.py
├── tools/
│   ├── codegen/
│   └── quality/
├── schemas/
│   ├── quickscale-config-v1.json
│   ├── migrations/
│   │   ├── v1_to_v2.json
│   │   └── README.md
│   └── examples/
│       ├── mvp-minimal.yml
│       ├── starter-basic.yml
│       ├── todo-with-payments.yml
│       └── enterprise-sample.yml
├── examples/
│   ├── minimal/
│   ├── starter-customized/
│   └── todo-extended/
├── quickscale_core/
├── quickscale_cli/                # CLI tool for project management (MVP: project generation only)
├── quickscale_modules/
│   ├── auth/
│   ├── payments/
│   ├── billing/
│   └── admin/               # Enhanced Django admin, monitoring, system config, audit logging
├── quickscale_themes/
│   ├── starter/
│   └── todo/
├── .github/
│   ├── workflows/
│   │   ├── ci.yml
│   │   ├── publish-core.yml
│   │   ├── publish-module.yml
│   │   └── docs.yml
│   ├── ISSUE_TEMPLATE/
│   └── dependabot.yml
├── .pre-commit-config.yaml
├── .editorconfig
└── .gitignore
```

### Example: personal monorepo (MVP-friendly layout)

ℹ️ **Note**: `quickscale_modules/` shown below is optional for personal monorepos only, NOT part of generated projects. See [Module Extraction Clarification](./decisions.md#integration-note-personal-toolkit-git-subtree-) for authoritative guidance.

The following example is the practical, MVP-friendly monorepo layout recommended for solo developers using the "Personal Toolkit" approach (git subtree). It's more verbose than the high-level Post-MVP tree above and is intended as a copyable reference for setting up your own quickscale monorepo.

```
quickscale/ (your private repo)
├── quickscale_core/                 # Core package: scaffolding, minimal utils (package source for maintainers)
│   └── src/quickscale_core/
│       ├── __init__.py
│       ├── settings/                # Base Django settings templates (used when embedding quickscale_core)
│       │   ├── base.py
│       │   ├── dev.py
│       │   └── production.py
│       ├── scaffold/                # Project generator templates + logic
│       │   ├── generator.py
│       │   └── templates/
│       │       ├── manage.py.j2
│       │       ├── settings.py.j2
│       │       └── pyproject.toml.j2
│       └── utils/
├── quickscale_cli/                  # Minimal CLI for `quickscale init` (CLI source for maintainers)
│   
│   └── src/quickscale_cli/
│       ├── main.py
│       └── commands/init.py
├── quickscale_modules/              # OPTIONAL personal-monorepo convenience for extracting reusable Django apps (NOT required for MVP)
│   ├── __init__.py                  # Optional convenience during MVP only. Remove before publishing as standalone packages.
│   ├── auth/
│   ├── billing/
│   └── common/
├── project_template/                # Cookiecutter-style starter template (optional)
│   └── {{project_name}}/
├── scripts/
│   ├── new_project.sh
│   └── extract_module.sh
├── docs/
│   └── workflows.md                 # git subtree examples and extraction notes
└── README.md
```

-- This layout is intentionally simple: core + CLI + (optional) modules + templates. Git subtree is a documented advanced workflow to embed `quickscale_core` into client repos. Lightweight CLI helpers for subtree operations are planned but not shipped as part of the initial `quickscale init` release. For authoritative technical decisions and tie-breakers, see `decisions.md`.
- Note on `__init__.py`: `quickscale_modules/` is intended as a PEP 420 namespace root in the Post-MVP architecture (no `__init__.py`). During early MVP development a temporary `__init__.py` may exist to simplify local imports; it is considered a local convenience and should be removed before extracting or publishing modules as standalone packages.

### Namespace Package Migration Examples

**Before (MVP - Regular Package)**:
```
quickscale_modules/
├── __init__.py              # ❌ Remove before publishing
├── auth/
│   ├── __init__.py          # ✅ Keep (leaf package)
│   ├── models.py
│   └── views.py
└── billing/
    ├── __init__.py          # ✅ Keep (leaf package)
    ├── models.py
    └── views.py
```

**After (Post-MVP - PEP 420 Namespace)**:
```
quickscale_modules/           # No __init__.py at namespace root
├── auth/
│   ├── __init__.py          # ✅ Keep (leaf package)
│   ├── models.py
│   └── views.py
└── billing/
    ├── __init__.py          # ✅ Keep (leaf package)
    ├── models.py
    └── views.py
```

- When a feature proves reusable, extract it into `quickscale_modules/<feature>/` and commit to the monorepo.
-- For archival history, keep long-form rationale and comparisons in `docs/legacy/` rather than the repo root.

Requirements vs Packaging note: See [Package Structure and Naming Conventions in decisions.md](./decisions.md#package-structure-and-naming-conventions) for canonical guidance on generated project dependencies versus package metadata.


---
## 12. AI Assistant Documentation Structure

This section shows where AI assistant guidance is located in the QuickScale documentation structure.

**Contributor Workflow Guides** (`docs/contrib/`):
```
docs/contrib/
├── contributing.md            # Human-facing index/navigation (canonical guide)
├── plan.md                    # Stage 1: planning & pre-task review
├── code.md                    # Stage 2: implementation rules
├── review.md                  # Stage 3: quality control / self-review
├── testing.md                 # Stage 4: test generation (implementation-first policy)
├── debug.md                   # Stage 5: debugging & root-cause analysis
└── shared/
    ├── code_principles.md
    ├── architecture_guidelines.md
    ├── testing_standards.md
    ├── task_focus_guidelines.md
    └── documentation_standards.md
```

**AI Prompt Templates** (`.github/prompts/`):
```
.github/prompts/
├── roadmap-plan-review-and-update.prompt.md
├── roadmap-task-implementation.prompt.md
└── release-commit-message-and-roadmap-cleaning.prompt.md
```

**For AI Assistants:** When working on QuickScale:
1. Start with `decisions.md` (authoritative technical rules)
2. Use this document (scaffolding.md) for structure examples
3. Consult `docs/contrib/` for workflow-specific guidance
4. Reference `.github/prompts/` for specialized task templates


---
## 3. Phase 1 (MVP) Required Structure {#mvp-structure}
Only `quickscale_core` + `quickscale_cli` needed. NO schemas, NO examples, NO packaged themes. Just project scaffolding templates.

🔎 **Scope note**: For in/out status defer to the [MVP Feature Matrix](./decisions.md#mvp-feature-matrix-authoritative). This section focuses on the file tree details only.

```
quickscale_core/
├── src/quickscale_core/
│   ├── __init__.py
│   ├── version.py
│   ├── generator/
│   │   ├── __init__.py
│   │   ├── generator.py            # ProjectGenerator with theme support (v0.61.0+)
│   │   └── templates/
│   │       ├── common/             # Shared templates (all themes)
│   │       │   ├── manage.py.j2
│   │       │   ├── pyproject.toml.j2
│   │       │   ├── Dockerfile.j2
│   │       │   ├── docker-compose.yml.j2
│   │       │   └── project_name/
│   │       │       ├── __init__.py.j2
│   │       │       ├── urls.py.j2
│   │       │       ├── wsgi.py.j2
│   │       │       ├── asgi.py.j2
│   │       │       └── settings/
│   │       │           ├── base.py.j2
│   │       │           ├── local.py.j2
│   │       │           └── production.py.j2
│   │       └── themes/             # Theme-specific templates (v0.61.0+)
│   │           ├── starter_html/   # Pure HTML/CSS theme (default)
│   │           │   ├── templates/
│   │           │   │   ├── base.html.j2
│   │           │   │   └── index.html.j2
│   │           │   └── static/
│   │           │       ├── css/style.css.j2
│   │           │       └── images/favicon.svg.j2
│   │           ├── starter_htmx/   # HTMX + Alpine.js theme (v0.66.0)
│   │           │   ├── templates/
│   │           │   │   ├── base.html.j2
│   │           │   │   └── index.html.j2
│   │           │   ├── static/
│   │           │   │   ├── css/
│   │           │   │   └── js/
│   │           │   └── package.json.j2  # Tailwind, Alpine.js
│   │           └── starter_react/  # React + TypeScript theme (v0.67.0)
│   │               ├── templates/  # Minimal Django templates (API only)
│   │               │   └── index.html.j2  # React mount point
│   │               └── frontend/
│   │                   ├── src/
│   │                   │   ├── main.tsx
│   │                   │   └── App.tsx
│   │                   ├── package.json.j2
│   │                   └── vite.config.ts.j2
│   └── utils/                      # Optional utilities (minimal)
│       ├── __init__.py
│       └── file_utils.py           # Basic file operations
└── tests/
    ├── test_generator/
    │   ├── test_generator.py
    │   ├── test_themes.py          # Theme selection tests (v0.61.0+)
    │   └── test_templates.py
    └── test_integration.py
```

**v0.61.0 Enhancements:**
- ✅ Theme system: `quickscale init myproject --template <name>`
- ✅ Themes are one-time copy, user owns generated code
- ✅ Default theme: `starter_html` (backward compatible, no flag required)
- ✅ Backend templates in `common/` (theme-agnostic)
- ✅ Frontend templates in `themes/{starter_html,starter_htmx,starter_react}/` (theme-specific)

**MVP Simplifications:**
- ❌ NO config/ directory (no YAML/JSON configuration loading in MVP)
- ❌ NO apps.py (not a Django app in MVP)
- ❌ NO complex utils (just basics)
- ❌ NO `backend_extensions.py` generation in MVP — see [backend_extensions.py policy](./decisions.md#backend-extensions-policy)
- ❌ NO automatic settings inheritance (standard Django `settings.py` only). Generated starters are standalone by default; optional inheritance patterns are documented for advanced users in `decisions.md`.

```
quickscale_cli/
├── pyproject.toml
├── src/quickscale_cli/
│   ├── __init__.py
│   ├── main.py                     # CLI entry point
│   └── commands/
│       ├── __init__.py
│       ├── init.py                 # 'quickscale init <name> --template <theme>'
│       ├── module_commands.py      # Module management (v0.61.0+)
│       │   ├── embed()            # 'quickscale embed --module <name>'
│       │   ├── update()           # 'quickscale update'
│       │   └── push()             # 'quickscale push --module <name>'
│       ├── dev_commands.py         # Dev workflows (v0.59.0)
│       │   ├── up()               # 'quickscale up'
│       │   ├── down()             # 'quickscale down'
│       │   ├── shell()            # 'quickscale shell'
│       │   └── manage()           # 'quickscale manage <args>'
│       └── deploy_commands.py      # Deployment (v0.60.0)
│           └── railway()          # 'quickscale deploy railway'
│   └── utils/
│       ├── __init__.py
│       └── git_utils.py            # Git subtree helpers (v0.61.0+)
│           ├── run_git_subtree_add()
│           ├── run_git_subtree_pull()
│           └── run_git_subtree_push()
└── tests/
    ├── test_init.py
    ├── test_module_commands.py     # Module embed/update/push tests (v0.61.0+)
    ├── test_dev_commands.py
    └── test_deploy_commands.py

**v0.61.0 Enhancements:**
- ✅ Theme selection: `quickscale init myproject --template <name>`
- ✅ Module management: `quickscale embed --module auth`, `quickscale update`, `quickscale push`
- ✅ Git subtree automation for modules (split branch distribution)
- ✅ `.quickscale/config.yml` tracking for installed modules

**Philosophy**: Simple, powerful commands for modern Django development.
```

---
### 3.5 MVP Prohibitions Checklist (Consolidated for AI Assistants) {#mvp-prohibitions}

> 📘 **Authoritative Source:** This checklist consolidates prohibitions from `decisions.md`. For detailed rationale and tie-breaker rulings, consult [decisions.md MVP Feature Matrix](./decisions.md#mvp-feature-matrix-authoritative).

**When generating MVP code, AI assistants MUST NOT include:**

**Configuration & Setup:**
- ❌ `quickscale.yml` or any YAML/JSON config files
- ❌ `config/` directory for configuration loading
- ❌ Multiple template variants or `--template` flag support
- ❌ `backend_extensions.py` generation (users add manually if needed)
- ❌ Automatic settings inheritance from `quickscale_core` (standalone settings.py only)

**Packages & Directory Structure:**
- ❌ `quickscale_modules/` directory in generated projects (maintainer-only convention)
- ❌ `quickscale_themes/` packages (Post-MVP only)
- ❌ `schemas/` directory (Post-MVP only)
- ❌ `examples/` directory in generated projects
- ❌ Nested package names like `quickscale/quickscale_core`
- ❌ Tests inside `src/` (use parallel `tests/` directory)
- ❌ README.md in sub-packages (root README.md only)

**CLI Commands & Automation:**
- ❌ CLI git subtree wrapper commands (`embed-core`, `update-core`, `sync-push`)
- ❌ `quickscale validate` or `generate` commands
- ❌ Flags/options for `quickscale init` (single command only)
- ❌ Multiple starter templates (single template only in MVP)

**Dependencies & Tooling:**
- ❌ `requirements.txt` files (use Poetry + pyproject.toml)
- ❌ `setup.py` files (use pyproject.toml)
- ❌ Black or Flake8 (use Ruff instead)
- ❌ Unpinned versions in production dependencies

**Architecture Patterns:**
- ❌ Runtime dynamic `INSTALLED_APPS` modifications
- ❌ DI frameworks or service registries (direct imports in production)
- ❌ Custom database table naming (use Django's app_label default)
- ❌ Complex frontend variants system (basic templates/ directory only)

**What MVP DOES Include:**
- ✅ Single command: `quickscale init <project>`
- ✅ Standalone Django project (manage.py, settings.py, urls.py, wsgi.py, asgi.py)
- ✅ Poetry packaging (pyproject.toml + poetry.lock)
- ✅ Production foundations: Docker, PostgreSQL config, pytest, CI/CD, security best practices
- ✅ Basic templates/ and static/ directories
- ✅ Manual git subtree documentation (commands in decisions.md)

**Decision Tree for AI Assistants:**
```
User requests YAML config? → Explain it's Post-MVP, suggest alternative
User wants multiple templates? → Explain single template MVP, note Post-MVP roadmap
User asks about quickscale_modules/? → Explain maintainer-only, NOT generated
Unsure if feature is MVP? → Check decisions.md MVP Feature Matrix (authoritative)
```

---
## 4. Post-MVP Expansion (Modules & Themes) {#post-mvp-structure}
Each module/theme is an independently publishable package. Namespaces `quickscale_modules` & `quickscale_themes` are PEP 420 implicit (no namespace `__init__.py`).

Example module (`auth`):
```
quickscale_modules/auth/
├── pyproject.toml
├── src/quickscale_modules/auth/
│   ├── __init__.py
│   ├── apps.py
│   ├── models.py
│   ├── services.py
│   ├── adapters.py
│   ├── urls.py
│   ├── views/
│   │   ├── __init__.py
│   │   └── login.py
│   ├── templates/quickscale_modules_auth/login.html
│   └── migrations/0001_initial.py
└── tests/
    ├── test_models.py
    ├── test_views.py
    └── test_integration.py
```

Example theme (`starter`):
```
quickscale_themes/starter/
├── pyproject.toml
├── src/quickscale_themes/starter/
│   ├── __init__.py
│   ├── apps.py
│   ├── base_models.py              # Inheritance-friendly base classes
│   ├── business.py
│   ├── urls.py
│   ├── templates/quickscale_themes_starter/
│   │   ├── base.html
│   │   └── dashboard.html
│   └── migrations/0001_initial.py
└── tests/
    ├── test_base_models.py
    └── test_business_logic.py
```

---
## 5. Generated Project Output
### 5.1 Base Project (Generated by `quickscale init`)
```
myapp/
├── manage.py                    # Standard Django
├── myapp/
│   ├── __init__.py
│   ├── settings/                # Split settings (v0.53.0+)
│   │   ├── __init__.py
│   │   ├── base.py             # Base Django settings
│   │   ├── local.py            # Local development settings
│   │   └── production.py       # Production settings
│   ├── urls.py                 # Minimal URL config
│   ├── wsgi.py
│   └── asgi.py
├── templates/                   # Theme-specific templates (v0.61.0+)
│   ├── base.html               # From selected theme (html/htmx/react)
│   └── index.html              # Homepage
├── static/                      # Theme-specific static files
│   ├── css/
│   │   └── style.css           # From selected theme
│   └── images/
│       └── favicon.svg
├── Dockerfile                   # Production-ready Docker image
├── docker-compose.yml           # Local dev environment (PostgreSQL, Redis)
├── pyproject.toml              # Poetry metadata and dependencies (generated)
├── poetry.lock                 # Deterministic lockfile generated from template
├── .env.example                # Environment variable template
├── .gitignore
└── README.md                   # Next steps guidance

# For React theme (v0.67.0+):
├── frontend/                    # React + TypeScript + Vite
│   ├── src/
│   │   ├── main.tsx
│   │   └── App.tsx
│   ├── package.json
│   └── vite.config.ts
```

**What Users Get:**
- Working Django project in 30 seconds
 - Choice of frontend theme: `quickscale init myapp --template <starter_html|starter_htmx|starter_react>`
- Runnable with `docker-compose up` (full stack) or `python manage.py runserver`
- 100% theirs to customize
- Production-ready Docker setup
- No QuickScale runtime dependencies unless they embed modules

### 5.2 With Embedded Modules (Optional, User Choice)
```
myapp/
├── .quickscale/                 # Module configuration (v0.61.0+)
│   └── config.yml              # Tracks installed modules
├── modules/                     # Embedded modules (git subtrees)
│   ├── auth/                   # From splits/auth-module
│   │   ├── __init__.py
│   │   ├── models.py
│   │   ├── views.py
│   │   ├── urls.py
│   │   ├── templates/
│   │   │   └── auth/          # Auth-specific templates (theme-aware)
│   │   ├── migrations/
│   │   └── tests/
│   └── billing/                # From splits/billing-module
│       ├── __init__.py
│       ├── models.py
│       ├── views.py
│       └── ...
├── manage.py
├── myapp/
│   ├── settings/
│   │   └── base.py            # INSTALLED_APPS += ["modules.auth", "modules.billing"]
│   └── urls.py                # include("modules.auth.urls"), include("modules.billing.urls")
└── ... (rest of project structure)
```

**How Users Get Modules:**
```bash
# Generate base project
quickscale init myapp --template starter_html

# Embed modules (optional)
cd myapp
git init  # Must be a git repo
quickscale embed --module auth
quickscale embed --module billing

# Update modules later
quickscale update  # Updates only installed modules
```

**`.quickscale/config.yml` Example:**
```yaml
# QuickScale module configuration
default_remote: https://github.com/<org>/quickscale.git

modules:
  auth:
    prefix: modules/auth
    branch: splits/auth-module
    installed_version: v0.62.0
    installed_at: 2025-10-23
  billing:
    prefix: modules/billing
    branch: splits/billing-module
    installed_version: v0.64.0
    installed_at: 2025-10-25
```

**What Users Get with Modules:**
- Reusable Django apps maintained by QuickScale
- Theme-agnostic backend code (works with all themes)
- Updatable over project lifetime via `quickscale update`
- Can contribute improvements back via `quickscale push`

### MVP Settings (Standalone)

Practical client settings example (how to import QuickScale base settings when `quickscale_core` is embedded via git subtree):

```python
# myapp/config/settings/base.py (MVP Pattern)
from pathlib import Path

BASE_DIR = Path(__file__).resolve().parent.parent.parent

# MVP uses standard Django settings (no inheritance)
# Settings inheritance from quickscale_core.settings is Post-MVP (TBD if needed)

DEBUG = True
ALLOWED_HOSTS = ['localhost']
SECRET_KEY = 'django-insecure-change-this-in-production'

# Standard Django configuration...
```

### Post-MVP Settings (Inheritance - Illustrative Only)

ℹ️ **Post-MVP reference**: See [`decisions.md`](./decisions.md#integration-note-personal-toolkit-git-subtree-) for the illustrative inheritance patterns. Phase 1 projects stay standalone.

Note: Settings inheritance shown above is illustrative and assumes you have manually embedded `quickscale_core` into your project using the documented git subtree workflow. See [decisions.md Settings Inheritance Policy](./decisions.md#mvp-feature-matrix-authoritative) for the authoritative policy and guidance on when to adopt inheritance vs standalone settings.

Prerequisite: Inheritance requires that `quickscale_core` is present in the client repository (for example via `git subtree add --prefix=quickscale <repo> main --squash`). This is an advanced workflow intended for users who maintain a personal monorepo or who intentionally embed core utilities — it is NOT part of the default `quickscale init` generated starter.

### Extraction workflow (Personal Toolkit)

When a feature implemented inside a client project becomes reusable, follow the extraction workflow:

1. Create a module folder inside `quickscale_modules/`, e.g. `quickscale_modules/reports/`.
2. Move or copy the reusable code from the client project into the module directory.
3. Add tests and generic configuration where needed.
4. Commit and push to your quickscale monorepo.
5. In client repos, add or update the module via git subtree.

**Git Subtree Commands (inline reference for convenience):**

> 📘 **Authoritative source:** [decisions.md §Git Subtree Integration](./decisions.md#integration-note-personal-toolkit-git-subtree) is the canonical location for these commands. This inline copy is provided for AI assistant convenience.

```bash
# Embed quickscale_core into client project
git subtree add --prefix=quickscale https://github.com/Experto-AI/quickscale.git main --squash

# Pull updates from quickscale repository
git subtree pull --prefix=quickscale https://github.com/Experto-AI/quickscale.git main --squash

# Push improvements back to quickscale repository (requires write access)
git subtree push --prefix=quickscale https://github.com/Experto-AI/quickscale.git feature-branch
```

**Notes:**
- Replace repository URL with your fork/private repo as appropriate
- `--squash` flag keeps client repo history clean
- CLI wrapper commands (`quickscale embed-core`, etc.) are Post-MVP backlog items
- See [CLI command matrix](./decisions.md#cli-command-matrix) for planned automation status

This extraction pattern keeps the MVP minimal while enabling shared improvements across your projects.

- **Deferred to Post-MVP (illustrative / NOT in MVP):**
- ❌ `quickscale.yml` and a `config/` directory (no YAML/JSON config system in MVP)
- ❌ backend_extensions.py (not generated by MVP; customize directly if needed)
- ❌ custom_frontend/ structure (just use templates/)
- ❌ variants system
- ❌ Embedded quickscale/ directory (optional, manual)

### 5.2 Post-MVP (Starter theme + modules, user selection)

ℹ️ **Post-MVP reference** – consult the MVP matrix for current scope.
```
myapp/
├── quickscale.yml           # Post-MVP illustrative for future config system
├── pyproject.toml           # (user-added, not generated by quickscale init)
├── manage.py
├── backend_extensions.py
├── myapp/
│   ├── __init__.py
│   ├── settings.py                 # Adds quickscale_core, theme, modules to INSTALLED_APPS
│   ├── urls.py
│   ├── asgi.py
│   ├── wsgi.py
│   └── modules_overrides/
│       └── __init__.py
├── custom_frontend/
│   ├── templates/
│   │   ├── base.html
│   │   ├── dashboard.html
│   │   └── overrides/ (optional theme template overrides)
│   ├── variants/
│   │   ├── default/
│   │   └── dark/
│   └── static/
│       ├── css/
│       ├── js/
│       └── img/
├── scripts/
│   ├── dev.sh
│   └── collectstatic.sh
└── README.md
```

---
## 6. Naming & Import Matrix (Summary)
| Concern | Import Path | Django App Label |
|--------|-------------|------------------|
| Core | quickscale_core | quickscale_core |
| CLI | quickscale_cli | (n/a) |
| Auth Module | quickscale_modules.auth | quickscale_modules_auth |
| Payments Module | quickscale_modules.payments | quickscale_modules_payments |
| Billing Module | quickscale_modules.billing | quickscale_modules_billing |
| Starter Theme | quickscale_themes.starter | quickscale_themes_starter |
| TODO Theme | quickscale_themes.todo | quickscale_themes_todo |

Rules: Dotted namespaces for imports, underscore-qualified app labels to avoid collisions. Shared namespace roots (`quickscale_modules`, `quickscale_themes`) are PEP 420 implicit (no `__init__.py`). This table is canonical; decisions.md references it rather than duplicating details.

---
## 7. Rationale Mapping to Decisions

> 📘 **Authoritative Source:** This table DESCRIBES how decisions.md rules map to scaffolding patterns. For the RULES themselves and conflict resolution, [decisions.md](./decisions.md) is authoritative and wins all conflicts.

**Purpose:** Show implementation relationship between technical decisions and directory structure.

| Decision (decisions.md) | Scaffold Enforcement | Notes |
|-------------------------|----------------------|-------|
| Library-Style Modules | Independent `quickscale_modules/<name>/` packages | Post-MVP only; NOT in generated projects |
| Configuration-Driven | Central `schemas/` + `config/` loader & validator | Post-MVP only; MVP uses standard Django settings |
| Backend Extension Pattern | Post‑MVP / illustrative: `backend_extensions.py` + theme `base_models.py` | MVP does NOT auto-generate this file |
| Directory-Based Frontend | `custom_frontend/` with `templates/`, `static/`, `variants/` | Post-MVP; MVP uses simple templates/ directory |
| Git Subtree Distribution | Manual `git subtree` commands documented in decisions.md | CLI wrappers are Post-MVP backlog items |
| PEP 420 Namespaces | No `__init__.py` at `quickscale_modules/` root | Post-MVP migration path from regular packages |
| Tests Outside src | `package/tests/` placement enforced | All packages (core, CLI, modules, themes) |
| Creation-Time Assembly | Generator emits static Django project (no runtime plugin loading) | Fundamental architectural principle |
| Poetry Packaging | `pyproject.toml` + `poetry.lock` (NO requirements.txt) | All QuickScale packages + generated projects |
| Ruff Tooling | Format + lint (replaces Black + Flake8) | Development standard for all packages |
| 70% Unit Test Coverage Per File | Minimum threshold enforced by CI (per file, not overall mean) | Critical quality gate |

**For AI Assistants:** When implementing:
1. Check [decisions.md](./decisions.md) for the RULE (what/why)
2. Use this table to understand WHERE to implement (structure)
3. Consult [§3.5 MVP Prohibitions](#mvp-prohibitions) for what NOT to do
4. Validate against [MVP Feature Matrix](./decisions.md#mvp-feature-matrix-authoritative) if uncertain

---
## 8. Evolution Phases & Incremental Adoption
| Phase | Adds | Deliverables |
|-------|------|-------------|
| 1 (MVP) | Core + CLI | Config load, scaffolding, create command, git subtree setup |
| 2 | Starter Theme | Theme packaging, inheritance base classes |
| 3 | First Module (auth) | Module packaging, settings integration |
| 4 | Update/Sync Commands | Full CLI for managing multiple client projects |
| 5 | Hooks & Advanced Modules | Extensibility, analytics, notifications |

Backward compatibility stance: Config migrations tracked under `schemas/migrations/` when schema version increments.

---
## 9. Crosswalk: Requirement → Artifact
| Requirement | Artifact |
|-------------|----------|
| Declarative config | `schemas/quickscale-config-v1.json`, `config/loader.py` |
| Simple project generation | `scaffold/generator.py` + templates tree |
| Backend inheritance | Post‑MVP / illustrative: `backend_extensions.py` + theme `base_models.py` (MVP does NOT auto-generate this file) |
| Frontend variants | `custom_frontend/variants/<variant>/` |
| Git subtree management | Manual git subtree commands are documented for transparency; the CLI does NOT expose wrapper commands for embed/update/sync workflows in the initial MVP. Potential helper automation sits on the Post-MVP backlog (see `quickscale_cli/`) and may be expanded if justified. |
| Shared updates | CLI wrapper commands for subtree update/sync remain Post-MVP backlog items and are NOT included in the initial MVP; additional helper libraries and batch automation may be expanded Post-MVP |
| Clear naming conventions | Packaging matrix (§6) |
| Future theme/module marketplace | Namespaced package roots + independent pyproject.toml files |

---
## 10. Future Optional Enhancements
- `integrations/` root for third-party connectors (post Phase 5)
- `playground/` (gitignored) for manual generation QA
- `benchmark/` for performance profiling scripts
- Automatic doc build pipeline -> `docs/reference/api/` from docstrings
- Scaffold diff/preview command: `quickscale preview` (dry-run)
- Config migration CLI: `quickscale migrate-config --from 1 --to 2`
-- Batch update commands (Post-MVP example): `quickscale update-all --dry-run`
- Pluggable template overlays for modules (`overrides/` folder detection)

---
## 11. Authoring & Maintenance Notes
- When adding a new package: follow naming matrix, create `pyproject.toml`, add to CI publish workflow.
- CLI commands (MVP): keep the surface limited to `quickscale init`. If Post-MVP wrapper commands ship, implement them in `quickscale_cli/commands/` with corresponding tests, ensure git operations delegate to a tested helper (for example `git/subtree_manager.py`), and update the [CLI command matrix](./decisions.md#cli-command-matrix). Manual `git subtree` commands remain documented for advanced users and recovery scenarios.
- Never place tests under `src/`; enforce via CI linter.
- Template additions require test coverage in `test_scaffold/test_templates.py`.
- CLI command additions require integration tests in `test_integration/`.
- Backwards-incompatible config changes require: schema bump, migration spec, docs update (`config-schema.md`).
- Keep `backend_extensions.py` minimal—users own its content, so minimize regeneration risk (no destructive overwrites).
 - Keep `backend_extensions.py` minimal—users own its content, so minimize regeneration risk (no destructive overwrites). Note: the MVP CLI will not generate this file automatically; Post‑MVP generators may offer an optional template.

---
## 13. E2E Test Infrastructure

**Purpose**: End-to-end testing infrastructure for validating complete project lifecycle with real database and browser automation.

**Structure**:
```
quickscale_core/tests/
├── test_e2e_full_workflow.py      # Main E2E test suite
│   ├── TestFullE2EWorkflow        # Complete lifecycle tests
│   ├── TestDockerIntegration      # Docker/compose validation
│   └── TestProductionReadiness    # Security/environment tests
├── docker-compose.test.yml        # PostgreSQL 16 test service definition
└── conftest.py                    # E2E fixtures (postgres_url, page, browser)
```

**Tech Stack**:
- `pytest-docker`: Manages PostgreSQL containers during test execution
- `pytest-playwright`: Browser automation for frontend UI testing
- Docker Compose: Defines test infrastructure (PostgreSQL service with health checks)
- Playwright: Chromium browser for end-to-end frontend tests

**Fixtures Provided** (in `conftest.py`):
- `postgres_service`: Session-scoped PostgreSQL container info (host, port, credentials)
- `postgres_url`: Full PostgreSQL connection URL for generated projects
- `page`, `browser`, `context`: Playwright browser automation fixtures
- `browser_context_args`: Custom browser configuration (viewport, HTTPS handling)

**Test Organization**:
```python
@pytest.mark.e2e
class TestFullE2EWorkflow:
    """Complete lifecycle: generate → install → migrate → serve → browse"""
    def test_complete_project_lifecycle(tmp_path, postgres_url, page):
        # Phase 1: Generate project
        # Phase 2: Install dependencies
        # Phase 3: Run migrations
        # Phase 4: Start dev server
        # Phase 5: Browser tests
```

**Key Patterns**:
- Test isolation via `tmp_path` (no codebase pollution)
- Atomic cleanup in `finally` blocks
- Server process management with timeout handling
- Screenshot capture on test failures
- Separate marker (`@pytest.mark.e2e`) for CI filtering

**CI Strategy**:
- Fast CI excludes E2E: `pytest -m "not e2e"`
- Release CI includes E2E: `pytest -m e2e`

For usage instructions, see [user_manual.md §2.1](./user_manual.md#21-end-to-end-e2e-tests).

---
**Status Legend (for ROADMAP correlation)**:
- Implemented: Update this file & ROADMAP
- Planned: Listed here, open tasks in ROADMAP
- Deferred: Mark explicitly in ROADMAP with rationale
- CLI Integration: Commands in `quickscale_cli/` with git subtree management

---
Maintainers: Update this document whenever structural conventions change. Treat as canonical scaffolding specification.
